function LP = init_LP_1027_fixed()
% ================================================================
% 三分支漂浮基座空间机器人（每支链 7 DOF）
% 结构定义符合 SpaceDyn 拓扑规范
% 作者：ChatGPT（GPT-5）
% 日期：2025-10-27
% ================================================================

%% ---------------- 基本参数 ----------------
LP.num_q = 21;                     % 总自由度数
LP.num_l = 21;                     % 连杆数
LP.num_b = 3;                      % 分支数

Ez = [0;0;1];

%% ---------------- 质量与惯性 ----------------
LP.m0 = 10;                        % 基座质量
LP.m  = 2 * ones(1,21);            % 每个连杆质量相同

% 基座惯性（正定）
LP.inertia0 = diag([0.05 0.05 0.05]);

% 连杆惯性（对称正定）
I_link = diag([0.01 0.01 0.005]);
LP.inertia = repmat(I_link,1,21);

%% ---------------- 拓扑矩阵定义 ----------------
LP.SS = zeros(21,21);              % link-link 连接矩阵
LP.S0 = zeros(1,21);               % base-link 连接向量
LP.SE = zeros(1,21);               % link-end effector 向量

% === 三个分支的结构定义 ===
% 支链1: link 1–7
% 支链2: link 8–14
% 支链3: link 15–21

% 每支链首连杆与基座相连
LP.S0([1 8 15]) = 1;

% 每支链内部相邻连杆串联
for i = 1:6
    LP.SS(i, i+1) = 1;       % 支链1
    LP.SS(7+i, 8+i) = 1;     % 支链2
    LP.SS(14+i, 15+i) = 1;   % 支链3
end

% 每支链最后一节为末端
LP.SE([7 14 21]) = 1;

%% ---------------- 连接向量定义 ----------------
% 坐标单位：m
link_len = 0.5;   % 每节连杆长度

LP.c0 = zeros(3,21);   % 基座到各分支起点
LP.ce = zeros(3,21);   % 各连杆终端到连杆坐标系
LP.cc = zeros(3,21,21);% 质心偏移向量

% 三个分支基座位置分布（以基座中心为原点）
LP.c0(:,1)  = [ 0.3;  0;  0];    % 支链1
LP.c0(:,8)  = [-0.3;  0.25; 0];  % 支链2
LP.c0(:,15) = [-0.3; -0.25; 0];  % 支链3

for i = 1:21
    LP.ce(:,i) = [0; 0; link_len];         % 末端方向沿 z 轴
end

% 每个连杆质心位于其长度中点
for i = 1:21
    LP.cc(:,i,i) = [0; 0; link_len/2];
end

%% ---------------- 关节定义 ----------------
LP.J_type = repmat('R',1,21);      % 全部旋转关节
LP.Q = zeros(21,1);                % 初始角度
LP.Qd = zeros(21,1);
LP.Qdd = zeros(21,1);

%% ---------------- 坐标系定义 ----------------
LP.A0 = eye(3);                    % 基座方向
LP.R0 = zeros(3,1);                % 基座位置

%% ---------------- 其他系统参数 ----------------
LP.g0 = [0;0;0];                   % 空间环境中无重力
LP.F0 = zeros(3,1);                % 外力（初始）
LP.T0 = zeros(3,1);                % 外力矩（初始）

%% ---------------- 末端力矩初始化 ----------------
LP.Fe = zeros(3,21);
LP.Te = zeros(3,21);

end
